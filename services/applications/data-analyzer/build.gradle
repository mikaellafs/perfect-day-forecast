/*
 * This file was generated by the Gradle 'init' task.
 */

apply plugin: 'application'

dependencies {
    implementation project(":components:data-analyzer")
    implementation project(":components:rabbit-support")
    implementation 'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.5.2'
    implementation 'com.rabbitmq:amqp-client:5.19.0'
    implementation 'com.google.code.gson:gson:2.8.8'
    implementation 'io.lettuce:lettuce-core:6.2.6.RELEASE'

    implementation 'com.zaxxer:HikariCP:5.0.1'
    implementation 'org.postgresql:postgresql:42.3.3'
    implementation 'org.jetbrains.exposed:exposed-core:0.37.3'

    implementation "ch.qos.logback:logback-classic:1.2.11"
}

application {
    // Define the main class for the application.
    mainClass = 'com.example.perfectdayforecast.app.AppKt'
}

tasks.withType(Copy).all {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

distTar {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

distZip {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

project.ext {
    RABBIT_URL = "amqp://localhost:5672"
    RABBIT_ANALYZER_EXCHANGE = "analyzer-ex"
    RABBIT_ANALYZER_QUEUE= "analyzer-qu"
    DATABASE_URL = "jdbc:postgresql://localhost:5432/perfectdayforecast?user=user&password=userpw"
}

tasks.withType(JavaExec) {
    doFirst {
        environment RABBIT_URL: project.RABBIT_URL
        environment RABBIT_ANALYZER_EXCHANGE: project.RABBIT_ANALYZER_EXCHANGE
        environment RABBIT_ANALYZER_QUEUE: project.RABBIT_ANALYZER_QUEUE
        environment DATABASE_URL: project.DATABASE_URL
    }
}